<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Matrix - CarlyleLiu‘s Blog</title><meta name="author" content="CarlyleLiu"><meta name="copyright" content="CarlyleLiu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="CarlyleLiu’s Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Matrix">
<meta property="og:url" content="https://carlyleliu.github.io/page/5/index.html">
<meta property="og:site_name" content="Matrix">
<meta property="og:description" content="CarlyleLiu’s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png">
<meta property="article:author" content="CarlyleLiu">
<meta property="article:tag" content="Matrix">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://carlyleliu.github.io/page/5/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Matrix',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2025-10-26 11:44:13'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<link rel="stylesheet" href="https://unpkg.zhimg.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.min.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Matrix" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">194</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('https://unsplash.it/1600/900?random')"><nav id="nav"><span id="blog-info"><a href="/" title="Matrix"><span class="site-name">Matrix</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">Matrix</h1><div id="site-subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="https://github.com/carlyleliu" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:yyliushuai@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-envelope" style="color: #24292e;"></i></a><a class="social-icon" href="https://twitter.com/yyliushuai" target="_blank" title="Twitter"><i class="fab fa-twitter" style="color: #24292e;"></i></a><a class="social-icon" href="https://youtube.com/carlyleliu" target="_blank" title="YouTube"><i class="fab fa-youtube" style="color: #24292e;"></i></a><a class="social-icon" href="https://instagram.com/blurredliu" target="_blank" title="Instagram"><i class="fab fa-instagram" style="color: #24292e;"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/LinuxDriver/LinuxAudioALSASummer/" title="Linux 驱动之 ALSA（一）概述"><img class="post-bg" src="https://unsplash.it/1600/900?random&amp;2469" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux 驱动之 ALSA（一）概述"></a></div><div class="recent-post-info"><a class="article-title" href="/LinuxDriver/LinuxAudioALSASummer/" title="Linux 驱动之 ALSA（一）概述">Linux 驱动之 ALSA（一）概述</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-01-05T22:42:52.000Z" title="发表于 2024-01-06 06:42:52">2024-01-06</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/">Technology Blog</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/Audio/">Audio</a></span></div><div class="content">ASOCALSA 是为桌面计算机而设计的，没有考虑嵌入式设备的限制，在处理嵌入式设备时会产生很多问题，包括但不限于如下：

编解码器和 CPU 之间的耦合太强，导致代码移植困难。
没有处理用户音频相关行为通知的标准方法，在移动场景中，用户的相关音频操作很频繁。
在最初的 ALSA 设置中没有考虑 PM 机制。

ASOC 就是为了解决以上问题而产生的。ALSA（ALSA system on chip， ASOC）层的目的是为嵌入式处理器和各种编解码器提供更好的 ALSA 支持。ASOC 具有以下优势：

独立的编解码器驱动程序。
更方便的配置 CPU 和编解码器动态音频电源管理（dynamic audio power management， DAPM）之间的音频数据接口。
减少弹出和点击操作，并增加与平台相关的控件。


为了实现上述功能，ASoC 将嵌入式音频系统划分为 3 个可重用的组件驱动程序，即机器类（machine class）、平台类（platform class）和编解码器类（codec）。其中，平台类和编解码器类是跨平台（cross-platform）的，而机器类是板级 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/LinuxDriver/LinuxUSBGadgetDriver/" title="USB 子系统（四）USB Gadget 驱动"><img class="post-bg" src="https://unsplash.it/1600/900?random&amp;8595" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="USB 子系统（四）USB Gadget 驱动"></a></div><div class="recent-post-info"><a class="article-title" href="/LinuxDriver/LinuxUSBGadgetDriver/" title="USB 子系统（四）USB Gadget 驱动">USB 子系统（四）USB Gadget 驱动</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-28T14:11:38.000Z" title="发表于 2023-09-28 22:11:38">2023-09-28</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/">Technology Blog</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/USB/">USB</a></span></div><div class="content">USB 控制器可以呈现出两种不同的状态。USB 控制器作为 Host 时，称为 USB 主机控制器，使用 USB 主机控制器驱动。USB 控制器作为 Device 时，称为 USB 设备控制器，使用 UDC（usb device controller）驱动。
USB 控制器作为 Device 时，最上层的是 Gadget Function 驱动，代表了具体设备的驱动，如 U 盘、USB 串口、USB 虚拟网卡、UAC 驱动。Composite 层是一个可选的中间层，可通过一种配置或多种配置高效的支持多种功能的设备，简化了 USB 复合设备驱动的开发。目前最流行的是使用基于 Composite 和 configfs 实现的 USB gadget configfs，可在用户空间灵活的配置 USB 设备。UDC 驱动直接访问硬件，控制 USB 设备与 USB 主机之间的通信。


Bus/Device/Driver模型

“USB接口”是逻辑上的USB设备，我们编写的usb_driver驱动程序，支持的是”USB接口”：  
USB控制器或Hub识别出USB设备后，会创建、注册usb_dei ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/LinuxDriver/LinuxUSBDeviceDescriptor/" title="USB 子系统（三）USB 设备描述符"><img class="post-bg" src="https://unsplash.it/1600/900?random&amp;7325" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="USB 子系统（三）USB 设备描述符"></a></div><div class="recent-post-info"><a class="article-title" href="/LinuxDriver/LinuxUSBDeviceDescriptor/" title="USB 子系统（三）USB 设备描述符">USB 子系统（三）USB 设备描述符</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-18T14:01:18.000Z" title="发表于 2023-09-18 22:01:18">2023-09-18</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/">Technology Blog</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/USB/">USB</a></span></div><div class="content">标准设备请求SETUP 事务的数据格式Host 使用控制传输来识别设备、设置设备地址、启动设备的某些特性，对于控制传输，它首先发出”setup 事务”，如下：

在”setup 事务”中，

SETUP 令牌包：用来通知设备，”要开始传输了”。
DATA0 数据包：它含有固定的格式，用来告诉设备”是读还是写”、”读什么”、”写什么”。

Hos 通过 DATA0 数据包发送 8 字节数据给设备，它的格式如下图所示：
标准设备请求控制传输的建立事务中，可以使用下列格式的数据：
上表中各个”宏”取值如下：
设备/配置/接口/端点在 SETUP 事务的数据里，表示了要访问的是什么：Device？Interface？Endpoint？
对于一个 USB 设备，它可以多种配置 (Configuration)。比如 4G 上网卡就有 2 种配置：U 盘、上网卡。第 1 次把 4G 上网卡插入电脑时，它是一个 U 盘，可以安装里面的程序。装好程序后，把它再次插入电脑，它就是一个上网卡。驱动程序可以选择让它工作于哪种配置，同一时间只能有一种配置。大多数的 USB 设备只有一种配置。
一个配置下，可以有 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/LinuxDriver/LinuxUSBProtoFormat/" title="USB 子系统（二）USB 协议层数据格式"><img class="post-bg" src="https://unsplash.it/1600/900?random&amp;1340" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="USB 子系统（二）USB 协议层数据格式"></a></div><div class="recent-post-info"><a class="article-title" href="/LinuxDriver/LinuxUSBProtoFormat/" title="USB 子系统（二）USB 协议层数据格式">USB 子系统（二）USB 协议层数据格式</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-12T13:11:31.000Z" title="发表于 2023-09-12 21:11:31">2023-09-12</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/">Technology Blog</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/USB/">USB</a></span></div><div class="content">硬件拓扑结构

compound device ：多个设备组合起来，通过 HUB 跟 Host 相连
composite device ：一个物理设备有多个逻辑设备 (multiple interfaces)


在软件开发过程中，我们可以忽略 Hub 的存在，硬件拓扑图简化如下：
一个物理设备里面可能有多个逻辑设备，Hos 可以外接多个逻辑设备，硬件拓扑图如下：
协议层
寻址设备阶段：USB 系统是一个 Host 对应多个设备，要传输数据首先要通知设备   
发出 IN 令牌包：表示想读数据，里面含有设备地址
发出 OUT 令牌包：表示想写数据，里面含有设备地址


数据传输阶段   
Host 想读数据：发出 IN 令牌包后读取数据包
Host 想发出数据：发出 OUT 令牌包后发出数据包


数据确认阶段   
Host 读数据，设备可能未就绪，就会回应 NAK 包
Host 写数据，它发出数据后，设备正确接收了，就回复 ACK 包



SYNC 域Host 发出 SOP 信号后，就会发出 SYNC 信号（前一节的那个 K-J-K-J-K-J-K 信号）：它是一系列的、最大传输 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/LinuxDriver/LinuxUSBEletrictFeature/" title="USB 子系统（一）USB 电器特性"><img class="post-bg" src="https://unsplash.it/1600/900?random&amp;3323" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="USB 子系统（一）USB 电器特性"></a></div><div class="recent-post-info"><a class="article-title" href="/LinuxDriver/LinuxUSBEletrictFeature/" title="USB 子系统（一）USB 电器特性">USB 子系统（一）USB 电器特性</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-08-09T11:15:01.000Z" title="发表于 2023-08-09 19:15:01">2023-08-09</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/">Technology Blog</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/USB/">USB</a></span></div><div class="content">USB 2.0 协议支持 3 种速率：低速 (Low Speed，1.5Mbps)、全速 (Full Speed, 12Mbps)、高速 (High Speed, 480Mbps)。
USB Hub、USB 设备，也分为低速、全速、高速三种类型。一个 USB 设备，可能兼容低速、全速，可能兼容全速、高速，但是不会同时兼容低速、高速。

USB 设备状态切换图

连接 (Attached)：USB 设备在已连接到 USB，但还没有上电的时候处于连接状态。
上电 (Powered)：USB 设备在已连接到 USB，并且已经上电，但还没有被复位的时候，处于上电状态。  USB 设备的电源获取分为两种，一种是通过外部电源进行获取，另一种是通过设备所连接的集线器 (hub) 处获得电源。通过外部供电的 USB 设备被称为自供电 (self-powered) 设备。尽管自供电设备在连接到 USB 之前可能已经有了电源，但在连接到 USB 并且 VBUS 被应用到设备之前，它们不被认为是处于上电状态。USB 设备可以同时支持自供电和总线供电 (bus-powered) 的配置。某些设备配置支持任一电 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/Camera/CameraISPYUVCE/" title="ISP YUV 域之 CE（Contrast Enhancement）"><img class="post-bg" src="https://unsplash.it/1600/900?random&amp;3912" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ISP YUV 域之 CE（Contrast Enhancement）"></a></div><div class="recent-post-info"><a class="article-title" href="/Camera/CameraISPYUVCE/" title="ISP YUV 域之 CE（Contrast Enhancement）">ISP YUV 域之 CE（Contrast Enhancement）</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-06-15T04:12:42.000Z" title="发表于 2023-06-15 12:12:42">2023-06-15</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/">Technology Blog</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/Image/">Image</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/Image/ISP/">ISP</a></span></div><div class="content">相关概念直方图 Histogram在分析图像数据的统计特性时，有时可以抛弃图像的色度分量，只考察图像的亮度分量，此时可以引入图像的亮度直方图（Luminance Histogram），以常用的 8 位精度图像为例，直方图的 X 轴为 0~255，共 256 个桶，每个桶刚好覆盖 1 个像素值，直方图的 Y 轴表示每个桶盛纳了多少个像素。所有桶中盛纳的像素数加到一起应等于图像的总像素数。

在分析画面的亮暗特征，人们经常把亮度区间定性地划分成暗调、阴影、中调、亮调、高光等几个区域，各区域的边界则可以根据应用特点灵活掌握。
当需要分析图像的颜色特性时，可以引入通道直方图（Channel Histogram），分别对 R/G/B 三个颜色通道进行直方图统计。
对比度 Contrast图像对比度指的是一幅图像中最亮的白和最暗的黑之间灰度反差的大小。差异越大代表对比越大，否则对比越小。一种常用的定量度量方法是 Michelson 对比度，定义为

C_M = \frac{I_{Max} - I_{Min}}{I_{Max} + I_{Min}}当一幅图像最白和最黑像素灰度都是 128 时，图像对 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/Camera/CameraISPYUVHueAndSaturation/" title="ISP YUV 域之 HueAndSaturation"><img class="post-bg" src="https://unsplash.it/1600/900?random&amp;9834" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ISP YUV 域之 HueAndSaturation"></a></div><div class="recent-post-info"><a class="article-title" href="/Camera/CameraISPYUVHueAndSaturation/" title="ISP YUV 域之 HueAndSaturation">ISP YUV 域之 HueAndSaturation</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-06-09T15:52:39.000Z" title="发表于 2023-06-09 23:52:39">2023-06-09</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/">Technology Blog</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/Image/">Image</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/Image/ISP/">ISP</a></span></div><div class="content">色调 Huehue 的定义hue 可以理解为占主导地位的纯色颜色，或两种纯色颜色的组合。简单来说，hue 就是颜色的“名字”，人们最常用黄色、橙色等概念来描述一个颜色。Hue is the color portion of the model, expressed as a number from 0 to 360 degrees.


Red: 0 and 60 degrees。
Yellow: 61 and 120 degrees。
Green: 121 and 180 degrees。
Cyan: 181 and 240 degrees。
Blue: 241 and 300 degrees。
Magenta: 301 and 360 degrees。

色调恒常 Hue constancy描述一个颜色的三个参数是 hue, lightness, chroma (saturation)。
色调恒常是指，当颜色的 lightness/saturation 改变时，色调的感知（sensation）保持不变。否则就是发生了色调漂移（hue shift）。
Tint = 在白色（或高亮白光 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/Camera/CameraISPYUVEdgeEnhancement/" title="ISP YUV 域之 EdgeEnhancement"><img class="post-bg" src="https://unsplash.it/1600/900?random&amp;2336" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ISP YUV 域之 EdgeEnhancement"></a></div><div class="recent-post-info"><a class="article-title" href="/Camera/CameraISPYUVEdgeEnhancement/" title="ISP YUV 域之 EdgeEnhancement">ISP YUV 域之 EdgeEnhancement</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-06-04T13:06:37.000Z" title="发表于 2023-06-04 21:06:37">2023-06-04</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/">Technology Blog</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/Image/">Image</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/Image/ISP/">ISP</a></span></div><div class="content">Retinex 理论Retinex 这个词由 Retina 和 Cortex 两个单词组成。在 Retinex 理论中，物体的颜色是由物体对长波、中波和短波光线的反射能力决定的，而不是由反射光强度的绝对值决定的，并且物体的色彩不受光照非均性的影响，具有一致性。

在 Retinex 理论中，人眼得到的图像数据取决于入射光和物体表面对入射光的反射。如上图所示，I(x,y) 是我们最终得到的图像数据，先是由入射光照射，然后经由物体反射进入成像系统，最终形成我们所看到的图像。该过程可以用公式表示：

I(x,y) = R(x,y) \cdot  L(x,y)其中，I(x,y) 代表被观察或照相机接收到的图像信号；L(x,y) 代表环境光的照射分量 ；R(x,y) 表示携带图像细节信息的目标物体的反射分量。将该式子两边取对数，可以得到物体原本的信息：

log[I(x,y)] = log[R(x,y)] - log[L(x,y)]在图像处理领域，常将该理论用于图像增强，为了得到成像更好的图片。这时，R(x,y) 表示为图像增强得到后的图像，I(x,y) 为原始的图像。在处理过程中 L(x,y) ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/Camera/CameraISPRawBayerDemosaic/" title="ISP Raw 域之 BayerDemosaic"><img class="post-bg" src="https://unsplash.it/1600/900?random&amp;7932" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ISP Raw 域之 BayerDemosaic"></a></div><div class="recent-post-info"><a class="article-title" href="/Camera/CameraISPRawBayerDemosaic/" title="ISP Raw 域之 BayerDemosaic">ISP Raw 域之 BayerDemosaic</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-05-30T15:17:53.000Z" title="发表于 2023-05-30 23:17:53">2023-05-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/">Technology Blog</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/Image/">Image</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/Image/ISP/">ISP</a></span></div><div class="content">Bayer Demosaic 概述RAW 域的最后一步处理是 Demosaic，将像素从 RAW 域变换到 RGB 域进行下一阶段的处理。Demosaic 算法的主要难点在于，RAW 域的任何一个像点（photosite）只包含一个真实的采样值，而构成像素（R,G,B）的其它两个值需要从周围像点中预测得到。既然是预测，就一定会发生预测不准的情况，这是不可避免的，而预测不准会带来多种负面影响，包括拉链效应（zipper artifacts），边缘模糊，颜色误差等。

所以 Demosaic 算法的主要挑战就是尽量提高算法的准确性，减少图像边缘损失和颜色误差。
Bayer 格式图像色彩恢复时有两种思路：

无方向性插值：不加边缘方向判断（思路：临近像素的均值），直接利用周围像素信息恢复。
有方向性插值：先判断边缘方向，再利用周围像素信息恢复。

Bayer 格式图像的绿色成分占比例较多，信息较丰富，色彩恢复时步骤通常是：a、先恢复 G 通道；b、再利用 G 通道信息恢复 R、B 通道。
CFA 双线性插值无边缘检测

绿色像素上的 R，B 值分别由相邻的 2 个 R，B 像素的灰度求平均值 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/Camera/CameraISPRawLSC/" title="ISPRaw 域之 LSC"><img class="post-bg" src="https://unsplash.it/1600/900?random&amp;9387" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ISPRaw 域之 LSC"></a></div><div class="recent-post-info"><a class="article-title" href="/Camera/CameraISPRawLSC/" title="ISPRaw 域之 LSC">ISPRaw 域之 LSC</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-05-30T15:16:00.000Z" title="发表于 2023-05-30 23:16:00">2023-05-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/">Technology Blog</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/Image/">Image</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Technology-Blog/Image/ISP/">ISP</a></span></div><div class="content">镜头阴影校正 LSC镜头阴影有两种表现形式，分别是

Luma shading，又称 vignetting，指由于镜头通光量从中心向边缘逐渐衰减导致画面边缘亮度变暗的现象。
Chroma shading，指由于镜头对不同波长的光线折射率不同引起焦平面位置分离导致图像出现伪彩的现象。


Vignetting 原理画面边缘镜头能量衰减：
如上图所示，由于镜头中都会存在多处光阑，当入射光线偏离光轴角度较大时，部分光线就会被光阑遮挡而不能参与成像，因此越靠近 sensor 边缘的像素接收到的曝光量就越低。
边缘像素微透镜和感光面的错位：
这个问题在手机 sensor 上通常会更严重一些，因此设计手机 sensor 的厂家会采取一些特定的方法去缓解这个问题。一种常用的方法是在微透镜上做文章，即从中心像素开始，微透镜的尺寸略小于感光面的面积一点点，这样越往边缘微透镜与感光面之间的错位就越大，刚好可以补偿入射光线角度增大导致的焦点偏移，使光线可以更好地聚焦到感光面上，如下图所示。
不过深入研究会发现，这个补偿办法其实也是有局限的，如果 sensor 采用的是下图左所示的 FSI 工艺（前照式），从 ...</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/4/#content-inner"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/#content-inner">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/#content-inner">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/#content-inner">20</a><a class="extend next" rel="next" href="/page/6/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">CarlyleLiu</div><div class="author-info__description">CarlyleLiu’s Blog</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">194</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/carlyleliu"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/carlyleliu" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:yyliushuai@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-envelope" style="color: #24292e;"></i></a><a class="social-icon" href="https://twitter.com/yyliushuai" target="_blank" title="Twitter"><i class="fab fa-twitter" style="color: #24292e;"></i></a><a class="social-icon" href="https://youtube.com/carlyleliu" target="_blank" title="YouTube"><i class="fab fa-youtube" style="color: #24292e;"></i></a><a class="social-icon" href="https://instagram.com/blurredliu" target="_blank" title="Instagram"><i class="fab fa-instagram" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">next主题站 https://carlyleliu.github.io/next</div></div><div class="sticky_layout"><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            
            </div>
            <ul class="card-category-list expandBtn" id="aside-cat-list">
            <li class="card-category-list-item parent"><a class="card-category-list-link" href="/categories/Literature-Appreciation/"><span class="card-category-list-name">Literature Appreciation</span><span class="card-category-list-count">6</span><i class="fas fa-caret-left "></i></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Literature-Appreciation/Poetry/"><span class="card-category-list-name">Poetry</span><span class="card-category-list-count">6</span></a></li></ul></li><li class="card-category-list-item parent"><a class="card-category-list-link" href="/categories/Science-Thought/"><span class="card-category-list-name">Science Thought</span><span class="card-category-list-count">8</span><i class="fas fa-caret-left "></i></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Science-Thought/Math/"><span class="card-category-list-name">Math</span><span class="card-category-list-count">6</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Science-Thought/Physics/"><span class="card-category-list-name">Physics</span><span class="card-category-list-count">2</span></a></li></ul></li><li class="card-category-list-item parent"><a class="card-category-list-link" href="/categories/Share/"><span class="card-category-list-name">Share</span><span class="card-category-list-count">4</span><i class="fas fa-caret-left "></i></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Share/Tools/"><span class="card-category-list-name">Tools</span><span class="card-category-list-count">4</span></a></li></ul></li><li class="card-category-list-item parent"><a class="card-category-list-link" href="/categories/Technology-Blog/"><span class="card-category-list-name">Technology Blog</span><span class="card-category-list-count">176</span><i class="fas fa-caret-left "></i></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Technology-Blog/Audio/"><span class="card-category-list-name">Audio</span><span class="card-category-list-count">9</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Technology-Blog/Image/"><span class="card-category-list-name">Image</span><span class="card-category-list-count">51</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Technology-Blog/Image/Encryption/"><span class="card-category-list-name">Encryption</span><span class="card-category-list-count">25</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Technology-Blog/Image/ISP/"><span class="card-category-list-name">ISP</span><span class="card-category-list-count">11</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Technology-Blog/Image/Lens/"><span class="card-category-list-name">Lens</span><span class="card-category-list-count">4</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Technology-Blog/Image/Sensor/"><span class="card-category-list-name">Sensor</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Technology-Blog/Image/Stabilization/"><span class="card-category-list-name">Stabilization</span><span class="card-category-list-count">9</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Technology-Blog/Linux/"><span class="card-category-list-name">Linux</span><span class="card-category-list-count">52</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Technology-Blog/Linux/Driver/"><span class="card-category-list-name">Driver</span><span class="card-category-list-count">16</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Technology-Blog/Linux/Kernel/"><span class="card-category-list-name">Kernel</span><span class="card-category-list-count">36</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Technology-Blog/Programming/"><span class="card-category-list-name">Programming</span><span class="card-category-list-count">33</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Technology-Blog/Programming/C-C/"><span class="card-category-list-name">C/C++</span><span class="card-category-list-count">11</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Technology-Blog/Programming/Debug/"><span class="card-category-list-name">Debug</span><span class="card-category-list-count">9</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Technology-Blog/Programming/Performance/"><span class="card-category-list-name">Performance</span><span class="card-category-list-count">4</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Technology-Blog/Programming/Principle/"><span class="card-category-list-name">Principle</span><span class="card-category-list-count">9</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Technology-Blog/RTOS/"><span class="card-category-list-name">RTOS</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Technology-Blog/Robot/"><span class="card-category-list-name">Robot</span><span class="card-category-list-count">7</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Technology-Blog/Robot/Actuator/"><span class="card-category-list-name">Actuator</span><span class="card-category-list-count">7</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Technology-Blog/TEE/"><span class="card-category-list-name">TEE</span><span class="card-category-list-count">5</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Technology-Blog/USB/"><span class="card-category-list-name">USB</span><span class="card-category-list-count">17</span></a></li></ul></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/Refactor/" style="font-size: 1.18em; color: #999ca1">Refactor</a> <a href="/tags/Driver/" style="font-size: 1.42em; color: #99a6b7">Driver</a> <a href="/tags/IMU/" style="font-size: 1.18em; color: #999ca1">IMU</a> <a href="/tags/Memory/" style="font-size: 1.3em; color: #99a1ac">Memory</a> <a href="/tags/Linux/" style="font-size: 1.5em; color: #99a9bf">Linux</a> <a href="/tags/Debug/" style="font-size: 1.34em; color: #99a3b0">Debug</a> <a href="/tags/Physics/" style="font-size: 1.14em; color: #999b9d">Physics</a> <a href="/tags/ucos/" style="font-size: 1.1em; color: #999">ucos</a> <a href="/tags/Poetry/" style="font-size: 1.26em; color: #999fa8">Poetry</a> <a href="/tags/Linear-Algebra/" style="font-size: 1.22em; color: #999ea4">Linear Algebra</a> <a href="/tags/Kernel/" style="font-size: 1.46em; color: #99a7bb">Kernel</a> <a href="/tags/USB/" style="font-size: 1.38em; color: #99a4b4">USB</a> <a href="/tags/Tools/" style="font-size: 1.22em; color: #999ea4">Tools</a> <a href="/tags/Performance/" style="font-size: 1.1em; color: #999">Performance</a> <a href="/tags/RTOS/" style="font-size: 1.14em; color: #999b9d">RTOS</a> <a href="/tags/Math/" style="font-size: 1.26em; color: #999fa8">Math</a> <a href="/tags/Odriver/" style="font-size: 1.18em; color: #999ca1">Odriver</a> <a href="/tags/FOC/" style="font-size: 1.18em; color: #999ca1">FOC</a></div></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">194</div></div><div class="webinfo-item"><div class="item-name">已运行时间 :</div><div class="item-count" id="runtimeshow" data-publishDate="2018-07-06T16:00:00.000Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2025-10-26T03:44:13.238Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2025 By CarlyleLiu</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>window.typedJSFn = {
  init: (str) => {
    window.typed = new Typed('#subtitle', Object.assign({
      strings: str,
      startDelay: 300,
      typeSpeed: 150,
      loop: true,
      backSpeed: 50,
    }, null))
  },
  run: (subtitleType) => {
    if (true) {
      if (typeof Typed === 'function') {
        subtitleType()
      } else {
        getScript('https://cdn.jsdelivr.net/npm/typed.js@2.1.0/dist/typed.umd.min.js').then(subtitleType)
      }
    } else {
      subtitleType()
    }
  }
}
</script><script>function subtitleType () {
  if (true) {
    typedJSFn.init(["潦倒不通世务，愚顽怕读文章","天下无能第一，古今不肖无双"])
  } else {
    document.getElementById("subtitle").textContent = "潦倒不通世务，愚顽怕读文章"
  }
}
typedJSFn.run(subtitleType)</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo" title=""><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly" title=""><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title=""><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><!-- hexo injector body_end end --></body></html>