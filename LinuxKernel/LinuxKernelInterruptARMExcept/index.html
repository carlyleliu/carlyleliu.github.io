<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="5txRYykRNG5Z1NrO_ZCLF1GZWnbFmCOLdJHGBVFuCIg">
  <meta name="baidu-site-verification" content="code-XfgDErPTZS">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Reddit+Mono:300,300italic,400,400italic,700,700italic%7CNoto+Sans:300,300italic,400,400italic,700,700italic%7COpen+Sans:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/black/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"carlyleliu.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.20.0","exturl":true,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"hide","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="åŸå›¾  å¼‚å¸¸çº§åˆ«  é€šå¸¸ ARM64 çš„è¿›ç¨‹æ‰§è¡Œåœ¨ EL0 çº§åˆ«ï¼Œå†…æ ¸æ‰§è¡Œåœ¨ EL1 çº§åˆ«ã€‚ è™šæ‹Ÿæœºæ˜¯ç°åœ¨æµè¡Œçš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œåœ¨è®¡ç®—æœºä¸Šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºï¼Œè™šæ‹Ÿæœºé‡Œå¯ä»¥è¿è¡Œä¸€ä¸ªæ“ä½œç³»ç»Ÿã€‚å¸¸ç”¨çš„å¼€æºè™šæ‹Ÿæœºç®¡ç†è½¯ä»¶æ˜¯ QEMUï¼ŒQEMU æ”¯æŒåŸºäºå†…æ ¸çš„è™šæ‹Ÿæœº KVMï¼ŒKVM çš„ç‰¹ç‚¹æ˜¯ç›´æ¥åœ¨å¤„ç†å™¨ä¸Šæ‰§è¡Œå®¢æˆ·æœºçš„æ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥è™šæ‹Ÿæœºçš„æ‰§è¡Œé€Ÿåº¦å¾ˆå¿«ã€‚ ARM64 æ¶æ„çš„å®‰å…¨æ‰©å±•å®šä¹‰äº†ä¸¤ç§å®‰å…¨çŠ¶æ€ï¼Œæ­£å¸¸ä¸–ç•Œå’Œå®‰å…¨">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux ä¸­æ–­å­ç³»ç»Ÿï¼ˆäºŒï¼‰ARM64 çš„å¼‚å¸¸å¤„ç†è¿‡ç¨‹">
<meta property="og:url" content="https://carlyleliu.github.io/LinuxKernel/LinuxKernelInterruptARMExcept/index.html">
<meta property="og:site_name" content="Matrix">
<meta property="og:description" content="åŸå›¾  å¼‚å¸¸çº§åˆ«  é€šå¸¸ ARM64 çš„è¿›ç¨‹æ‰§è¡Œåœ¨ EL0 çº§åˆ«ï¼Œå†…æ ¸æ‰§è¡Œåœ¨ EL1 çº§åˆ«ã€‚ è™šæ‹Ÿæœºæ˜¯ç°åœ¨æµè¡Œçš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œåœ¨è®¡ç®—æœºä¸Šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºï¼Œè™šæ‹Ÿæœºé‡Œå¯ä»¥è¿è¡Œä¸€ä¸ªæ“ä½œç³»ç»Ÿã€‚å¸¸ç”¨çš„å¼€æºè™šæ‹Ÿæœºç®¡ç†è½¯ä»¶æ˜¯ QEMUï¼ŒQEMU æ”¯æŒåŸºäºå†…æ ¸çš„è™šæ‹Ÿæœº KVMï¼ŒKVM çš„ç‰¹ç‚¹æ˜¯ç›´æ¥åœ¨å¤„ç†å™¨ä¸Šæ‰§è¡Œå®¢æˆ·æœºçš„æ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥è™šæ‹Ÿæœºçš„æ‰§è¡Œé€Ÿåº¦å¾ˆå¿«ã€‚ ARM64 æ¶æ„çš„å®‰å…¨æ‰©å±•å®šä¹‰äº†ä¸¤ç§å®‰å…¨çŠ¶æ€ï¼Œæ­£å¸¸ä¸–ç•Œå’Œå®‰å…¨">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lsky.carlyleliu.vip/carlyleliu/ImageHosting/TechnologyBlog/Kernel/IRQExceptProcess.png">
<meta property="og:image" content="https://lsky.carlyleliu.vip/carlyleliu/ImageHosting/TechnologyBlog/Kernel/ARM64_ELEVEL.png">
<meta property="og:image" content="https://lsky.carlyleliu.vip/carlyleliu/ImageHosting/TechnologyBlog/Kernel/armv8_vector.png">
<meta property="article:published_time" content="2021-09-14T08:03:15.000Z">
<meta property="article:modified_time" content="2025-04-12T10:29:22.000Z">
<meta property="article:author" content="CarlyleLiu">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="Kernel">
<meta property="article:tag" content="Interrupt">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lsky.carlyleliu.vip/carlyleliu/ImageHosting/TechnologyBlog/Kernel/IRQExceptProcess.png">


<link rel="canonical" href="https://carlyleliu.github.io/LinuxKernel/LinuxKernelInterruptARMExcept/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://carlyleliu.github.io/LinuxKernel/LinuxKernelInterruptARMExcept/","path":"LinuxKernel/LinuxKernelInterruptARMExcept/","title":"Linux ä¸­æ–­å­ç³»ç»Ÿï¼ˆäºŒï¼‰ARM64 çš„å¼‚å¸¸å¤„ç†è¿‡ç¨‹"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Linux ä¸­æ–­å­ç³»ç»Ÿï¼ˆäºŒï¼‰ARM64 çš„å¼‚å¸¸å¤„ç†è¿‡ç¨‹ | Matrix</title>
  







<link rel="dns-prefetch" href="https://waline.carlyleliu.vip">
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Matrix" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Matrix</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">CarlyleLiuâ€˜s Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li><li class="menu-item menu-item-alist"><span class="exturl" data-url="aHR0cHM6Ly9hbGlzdC5jYXJseWxlbGl1LnZpcC8="><i class="fa-solid fa-cloud fa-fw"></i>ç½‘ç›˜</span></li><li class="menu-item menu-item-books"><span class="exturl" data-url="aHR0cHM6Ly9jYWxpYnJlLmNhcmx5bGVsaXUudmlwLw=="><i class="fa-solid fa-book fa-fw"></i>ä¹¦åº“</span></li><li class="menu-item menu-item-talk"><span class="exturl" data-url="aHR0cHM6Ly9tZW1vcy5jYXJseWxlbGl1LnZpcC9leHBsb3JlLw=="><i class="fas fa-comments fa-fw"></i>éšç¬”</span></li><li class="menu-item menu-item-album"><span class="exturl" data-url="aHR0cHM6Ly9pbW1pY2guY2FybHlsZWxpdS52aXAvc2hhcmUvSmtSenVqZERfdWVJRnJRNHpvYnpfUW1EVndRZkdGS3ZyVTh0ZlJIYWN1ZG9ZMjV0Z2tFdDd6aS1Wck5oYUEzZUdpNC8="><i class="fa-solid fa-image fa-fw"></i>ç›¸å†Œ</span></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="æœç´¢..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E7%BA%A7%E5%88%AB"><span class="nav-text"> å¼‚å¸¸çº§åˆ«</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E7%B1%BB%E5%9E%8B"><span class="nav-text"> å¼‚å¸¸ç±»å‹</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%AD%E6%96%AD"><span class="nav-text"> ä¸­æ–­</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%AD%E6%AD%A2"><span class="nav-text"> ä¸­æ­¢</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%8D%E4%BD%8D"><span class="nav-text"> å¤ä½</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BD%AF%E4%BB%B6%E4%BA%A7%E7%94%9F%E7%9A%84%E5%BC%82%E5%B8%B8"><span class="nav-text"> è½¯ä»¶äº§ç”Ÿçš„å¼‚å¸¸</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5%E5%BC%82%E5%B8%B8%E5%92%8C%E5%BC%82%E6%AD%A5%E5%BC%82%E5%B8%B8"><span class="nav-text"> åŒæ­¥å¼‚å¸¸å’Œå¼‚æ­¥å¼‚å¸¸</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E7%9A%84%E5%8F%91%E7%94%9F%E5%92%8C%E9%80%80%E5%87%BA"><span class="nav-text"> å¼‚å¸¸çš„å‘ç”Ÿå’Œé€€å‡º</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E5%90%91%E9%87%8F%E8%A1%A8"><span class="nav-text"> å¼‚å¸¸å‘é‡è¡¨</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E5%90%91%E9%87%8F%E8%A1%A8%E5%9C%A8-linux-%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%89%A9%E5%B1%95"><span class="nav-text"> å¼‚å¸¸å‘é‡è¡¨åœ¨ Linux ä¸­çš„å®ç°ï¼ˆæ‰©å±•ï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B1%87%E7%BC%96%E5%AE%8F%E5%AE%9A%E4%B9%89"><span class="nav-text"> æ±‡ç¼–å®å®šä¹‰</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%BA%90%E7%A0%81"><span class="nav-text"> æºç </span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="nav-text"> å‚è€ƒæ–‡çŒ®</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">CarlyleLiu</p>
  <div class="site-description" itemprop="description">CarlyleLiuâ€™s Blog</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">212</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nhcmx5bGVsaXU=" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;carlyleliu"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOnl5bGl1c2h1YWlAZ21haWwuY29t" title="E-Mail â†’ mailto:yyliushuai@gmail.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS95eWxpdXNodWFp" title="Twitter â†’ https:&#x2F;&#x2F;twitter.com&#x2F;yyliushuai"><i class="fab fa-twitter fa-fw"></i>Twitter</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly95b3V0dWJlLmNvbS9jYXJseWxlbGl1" title="YouTube â†’ https:&#x2F;&#x2F;youtube.com&#x2F;carlyleliu"><i class="fab fa-youtube fa-fw"></i>YouTube</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9pbnN0YWdyYW0uY29tL2JsdXJyZWRsaXU=" title="Instagram â†’ https:&#x2F;&#x2F;instagram.com&#x2F;blurredliu"><i class="fab fa-instagram fa-fw"></i>Instagram</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC96aC1DTg=="><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
    </div>

    
        <div class="pjax">
        </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://carlyleliu.github.io/LinuxKernel/LinuxKernelInterruptARMExcept/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CarlyleLiu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Matrix">
      <meta itemprop="description" content="CarlyleLiuâ€™s Blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Linux ä¸­æ–­å­ç³»ç»Ÿï¼ˆäºŒï¼‰ARM64 çš„å¼‚å¸¸å¤„ç†è¿‡ç¨‹ | Matrix">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Linux ä¸­æ–­å­ç³»ç»Ÿï¼ˆäºŒï¼‰ARM64 çš„å¼‚å¸¸å¤„ç†è¿‡ç¨‹
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Technology-Blog/" itemprop="url" rel="index"><span itemprop="name">Technology Blog</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Technology-Blog/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
          ï¼Œ
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Technology-Blog/Linux/Kernel/" itemprop="url" rel="index"><span itemprop="name">Kernel</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Walineï¼š</span>
  
    <a title="waline" href="/LinuxKernel/LinuxKernelInterruptARMExcept/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/LinuxKernel/LinuxKernelInterruptARMExcept/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>2.6k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>9 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p><img src="https://lsky.carlyleliu.vip/carlyleliu/ImageHosting/TechnologyBlog/Kernel/IRQExceptProcess.png" alt=""><br>
<span class="exturl" data-url="aHR0cHM6Ly93d3cucHJvY2Vzc29uLmNvbS9lbWJlZC82MjM1Nzk2NjA3OTEyOTA2ZjUwN2QxMDg=">åŸå›¾<i class="fa fa-external-link-alt"></i></span></p>
<h1 id="å¼‚å¸¸çº§åˆ«"><a class="markdownIt-Anchor" href="#å¼‚å¸¸çº§åˆ«"></a> å¼‚å¸¸çº§åˆ«</h1>
<p><img src="https://lsky.carlyleliu.vip/carlyleliu/ImageHosting/TechnologyBlog/Kernel/ARM64_ELEVEL.png" alt=""></p>
<p>é€šå¸¸ ARM64 çš„è¿›ç¨‹æ‰§è¡Œåœ¨ EL0 çº§åˆ«ï¼Œå†…æ ¸æ‰§è¡Œåœ¨ EL1 çº§åˆ«ã€‚</p>
<p>è™šæ‹Ÿæœºæ˜¯ç°åœ¨æµè¡Œçš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œåœ¨è®¡ç®—æœºä¸Šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºï¼Œè™šæ‹Ÿæœºé‡Œå¯ä»¥è¿è¡Œä¸€ä¸ªæ“ä½œç³»ç»Ÿã€‚å¸¸ç”¨çš„å¼€æºè™šæ‹Ÿæœºç®¡ç†è½¯ä»¶æ˜¯ QEMUï¼ŒQEMU æ”¯æŒåŸºäºå†…æ ¸çš„è™šæ‹Ÿæœº KVMï¼ŒKVM çš„ç‰¹ç‚¹æ˜¯ç›´æ¥åœ¨å¤„ç†å™¨ä¸Šæ‰§è¡Œå®¢æˆ·æœºçš„æ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥è™šæ‹Ÿæœºçš„æ‰§è¡Œé€Ÿåº¦å¾ˆå¿«ã€‚</p>
<p>ARM64 æ¶æ„çš„å®‰å…¨æ‰©å±•å®šä¹‰äº†ä¸¤ç§å®‰å…¨çŠ¶æ€ï¼Œæ­£å¸¸ä¸–ç•Œå’Œå®‰å…¨ä¸–ç•Œï¼Œä¸¤ä¸ªä¸–ç•Œåªèƒ½é€šè¿‡å¼‚å¸¸çº§åˆ« 3 çš„å®‰å…¨ç›‘è§†å™¨åˆ‡æ¢ã€‚</p>
<span id="more"></span>
<h1 id="å¼‚å¸¸ç±»å‹"><a class="markdownIt-Anchor" href="#å¼‚å¸¸ç±»å‹"></a> å¼‚å¸¸ç±»å‹</h1>
<h2 id="ä¸­æ–­"><a class="markdownIt-Anchor" href="#ä¸­æ–­"></a> ä¸­æ–­</h2>
<p>åœ¨ ARM å¤„ç†å™¨ä¸­ï¼ŒFIQï¼ˆFast Interruptre Questï¼‰çš„ä¼˜å…ˆçº§è¦é«˜äº IRQï¼ˆInterrupt ReQuestï¼‰ã€‚åœ¨èŠ¯ç‰‡å†…éƒ¨ï¼Œåˆ†åˆ«ç”± IRQ å’Œ FIQ ä¸¤æ ¹ä¸­æ–­çº¿è¿æ¥åˆ°ä¸­æ–­æ§åˆ¶å™¨å†è¿æ¥åˆ°å¤„ç†å™¨å†…éƒ¨ï¼Œå‘é€ä¸­æ–­ä¿¡å·ç»™å¤„ç†å™¨ã€‚</p>
<h3 id="ä¸­æ­¢"><a class="markdownIt-Anchor" href="#ä¸­æ­¢"></a> ä¸­æ­¢</h3>
<p>ä¸­æ­¢ï¼ˆabortï¼‰ä¸»è¦æœ‰æŒ‡ä»¤ä¸­æ­¢ï¼ˆinstruction abortï¼‰å’Œæ•°æ®ä¸­æ­¢ï¼ˆdata abortï¼‰ä¸¤ç§ï¼Œé€šå¸¸æ˜¯å› ä¸ºè®¿é—®å¤–éƒ¨å­˜å‚¨å•å…ƒæ—¶å‘ç”Ÿäº†é”™è¯¯ï¼Œå¤„ç†å™¨å†…éƒ¨çš„ MMUï¼ˆMemory Management Unitï¼‰èƒ½æ•è·è¿™äº›é”™è¯¯å¹¶ä¸”æŠ¥å‘Šç»™å¤„ç†å™¨ã€‚æŒ‡ä»¤ä¸­æ­¢æ˜¯æŒ‡å½“å¤„ç†å™¨å°è¯•æ‰§è¡ŒæŸæ¡æŒ‡ä»¤æ—¶å‘ç”Ÿäº†é”™è¯¯ï¼Œè€Œæ•°æ®ä¸­æ­¢æ˜¯æŒ‡ä½¿ç”¨åŠ è½½æˆ–å­˜å‚¨æŒ‡ä»¤è¯»å†™å¤–éƒ¨å­˜å‚¨å•å…ƒæ—¶å‘ç”Ÿäº†é”™è¯¯ã€‚</p>
<h2 id="å¤ä½"><a class="markdownIt-Anchor" href="#å¤ä½"></a> å¤ä½</h2>
<p>å¤ä½ï¼ˆresetï¼‰æ“ä½œæ˜¯ä¼˜å…ˆçº§æœ€é«˜çš„ä¸€ç§å¼‚å¸¸å¤„ç†ï¼Œå¤ä½æ“ä½œåŒ…æ‹¬ä¸Šç”µå¤ä½å’Œæ‰‹åŠ¨å¤ä½ä¸¤ç§ã€‚</p>
<h2 id="è½¯ä»¶äº§ç”Ÿçš„å¼‚å¸¸"><a class="markdownIt-Anchor" href="#è½¯ä»¶äº§ç”Ÿçš„å¼‚å¸¸"></a> è½¯ä»¶äº§ç”Ÿçš„å¼‚å¸¸</h2>
<p>ARMv8 åŠ æ„æä¾›äº† 3 ç§è½¯ä»¶äº§ç”Ÿçš„å¼‚å¸¸ã€‚å‘ç”Ÿè¿™äº›å¼‚å¸¸é€šå¸¸æ˜¯å› ä¸ºè½¯ä»¶æƒ³å°è¯•è¿›å…¥é«˜çš„å¼‚å¸¸ç­‰çº§ã€‚</p>
<ul>
<li>SVC æŒ‡ä»¤ï¼šå…è®¸ç”¨æˆ·æ¨¡å¼ä¸‹çš„ç¨‹åºè¯·æ±‚æ“ä½œç³»ç»ŸæœåŠ¡</li>
<li>HVC æŒ‡ä»¤ï¼šå…è®¸å®¢æˆ·æœºï¼ˆguestOSï¼‰è¯·æ±‚ä¸»æœºæœåŠ¡</li>
<li>SMC æŒ‡ä»¤ï¼šå…è®¸æ™®é€šä¸–ç•Œï¼ˆnormal worldï¼‰ä¸­çš„ç¨‹åºè¯·æ±‚å®‰å…¨ç›‘æ§æœåŠ¡</li>
</ul>
<h1 id="åŒæ­¥å¼‚å¸¸å’Œå¼‚æ­¥å¼‚å¸¸"><a class="markdownIt-Anchor" href="#åŒæ­¥å¼‚å¸¸å’Œå¼‚æ­¥å¼‚å¸¸"></a> åŒæ­¥å¼‚å¸¸å’Œå¼‚æ­¥å¼‚å¸¸</h1>
<p>ARMv8 æ¶æ„æŠŠå¼‚å¸¸åˆ†æˆåŒæ­¥å¼‚å¸¸å’Œå¼‚æ­¥å¼‚å¸¸ä¸¤ç§ã€‚åŒæ­¥å¼‚å¸¸æ˜¯æŒ‡å¤„ç†å™¨éœ€è¦ç­‰å¾…å¼‚å¸¸å¤„ç†çš„ç»“æœï¼Œç„¶åå†ç»§ç»­æ‰§è¡Œåé¢çš„æŒ‡ä»¤ï¼Œæ¯”å¦‚æ•°æ®ä¸­æ­¢å‘ç”Ÿæ—¶æˆ‘ä»¬çŸ¥é“å‘ç”Ÿæ•°æ®å¼‚å¸¸çš„åœ°å€ï¼Œå› è€Œå¯ä»¥åœ¨å¼‚å¸¸å¤„ç†å‡½æ•°ä¸­ä¿®å¤è¿™ä¸ªåœ°å€ã€‚å¸¸è§çš„åŒæ­¥å¼‚å¸¸å¦‚ä¸‹ã€‚</p>
<ul>
<li>å°è¯•è®¿é—®å¼‚å¸¸ç­‰çº§ä¸æ°å½“çš„å¯„å­˜å™¨</li>
<li>å°è¯•æ‰§è¡Œæ²¡æœ‰å®šä¹‰ï¼ˆUNDEFINEDï¼‰çš„æŒ‡ä»¤</li>
<li>ä½¿ç”¨æ²¡æœ‰å¯¹é½çš„ SP æˆ–æ‰§è¡Œæ²¡æœ‰å¯¹é½çš„ PC æŒ‡ä»¤</li>
<li>è½¯ä»¶äº§ç”Ÿçš„å¼‚å¸¸ï¼Œæ¯”å¦‚æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼ˆSVCï¼‰ã€HVC æˆ– SMC æŒ‡ä»¤</li>
<li>å› åœ°å€ç¿»è¯‘æˆ–æƒé™ç­‰å¯¼è‡´çš„æ•°æ®å¼‚å¸¸æˆ–æŒ‡ä»¤å¼‚å¸¸</li>
<li>è°ƒè¯•å¯¼è‡´çš„å¼‚å¸¸ï¼Œæ¯”å¦‚æ–­ç‚¹å¼‚å¸¸ã€è§‚å¯Ÿç‚¹å¼‚å¸¸ã€è½¯ä»¶å•æ­¥å¼‚å¸¸ç­‰</li>
</ul>
<p>ä¸­æ–­å‘ç”Ÿæ—¶ï¼Œå¤„ç†å™¨æ­£åœ¨å¤„ç†çš„æŒ‡ä»¤å’Œä¸­æ–­æ˜¯å®Œå…¨æ²¡æœ‰å…³ç³»çš„ï¼Œå®ƒä»¬ä¹‹é—´æ²¡æœ‰ä¾èµ–å…³ç³»å› æ­¤ï¼ŒæŒ‡ä»¤å¼‚å¸¸å’Œæ•°æ®å¼‚å¸¸ç§°ä¸ºåŒæ­¥å¼‚å¸¸ï¼Œè€Œä¸­æ–­ç§°ä¸ºå¼‚æ­¥å¼‚å¸¸ã€‚å¸¸è§çš„å¼‚æ­¥å¼‚å¸¸åŒ…æ‹¬ç‰©ç†ä¸­æ–­å’Œè™šæ‹Ÿä¸­æ–­ã€‚</p>
<ul>
<li>ç‰©ç†ä¸­æ–­åˆ†ä¸ºç³»ç»Ÿé”™è¯¯ã€IRQã€FIQã€‚</li>
<li>è™šæ‹Ÿä¸­æ–­åˆ†ä¸º vSErrorã€ vIRQã€vFIQã€‚</li>
</ul>
<h1 id="å¼‚å¸¸çš„å‘ç”Ÿå’Œé€€å‡º"><a class="markdownIt-Anchor" href="#å¼‚å¸¸çš„å‘ç”Ÿå’Œé€€å‡º"></a> å¼‚å¸¸çš„å‘ç”Ÿå’Œé€€å‡º</h1>
<p>å½“å¼‚å¸¸å‘ç”Ÿæ—¶ï¼ŒCPU ä¼šè‡ªåŠ¨åšå¦‚ä¸‹ä¸€äº›äº‹æƒ…ã€‚</p>
<ul>
<li>å°†å¤„ç†å™¨çŠ¶æ€å¯„å­˜å™¨ PSTATE ä¿å­˜åˆ°å¯¹åº”ç›®æ ‡å¼‚å¸¸ç­‰çº§çš„ SPSR_ELx ä¸­</li>
<li>å°†è¿”å›åœ°å€ä¿å­˜åœ¨å¯¹åº”ç›®æ ‡å¼‚å¸¸ç­‰çº§çš„ ELRELx ä¸­</li>
<li>æŠŠ PSTATE å¯„å­˜å™¨é‡Œçš„ DAIF åŸŸéƒ½è®¾ç½®ä¸º 1ï¼Œè¿™ç›¸å½“äºæŠŠè°ƒè¯•å¼‚å¸¸ã€ç³»ç»Ÿé”™è¯¯ ï¼ˆSErrorï¼‰ã€IRQ ä»¥åŠ FIQ éƒ½å…³é—­äº†ã€‚å…·ä½“å¼‚å¸¸åŸå› éœ€è¦æŸ¥çœ‹ ESR_ELx</li>
<li>è®¾ç½®æ ˆæŒ‡é’ˆï¼ŒæŒ‡å‘å¯¹åº”ç›®æ ‡å¼‚å¸¸ç­‰çº§ä¸‹çš„æ ˆï¼Œè‡ªåŠ¨åˆ‡æ¢ SP åˆ° SP_ELx</li>
<li>CPU å¤„ç†å™¨ä¼šä»å¼‚å¸¸å‘ç”Ÿç°åœºçš„å¼‚å¸¸ç­‰çº§åˆ‡æ¢åˆ°å¯¹åº”ç›®æ ‡å¼‚å¸¸ç­‰çº§ï¼Œç„¶åè·³è½¬åˆ°å¼‚å¸¸å‘é‡è¡¨å¹¶æ‰§è¡Œ</li>
</ul>
<p>ä¸Šè¿°æ˜¯ ARMv8 å¤„ç†å™¨æ£€æµ‹åˆ°å¼‚å¸¸å‘ç”Ÿåè‡ªåŠ¨åšçš„äº‹æƒ…ã€‚æ“ä½œç³»ç»Ÿéœ€è¦åšçš„äº‹æƒ…æ˜¯ä»ä¸­æ–­å‘é‡è¡¨å¼€å§‹ï¼Œæ ¹æ®å¼‚å¸¸å‘ç”Ÿçš„ç±»å‹ï¼Œè·³è½¬åˆ°åˆé€‚çš„å¼‚å¸¸å‘é‡è¡¨ã€‚å¼‚å¸¸å‘é‡è¡¨ä¸­çš„æ¯é¡¹ä¼šä¿å­˜ä¸€ä¸ªå¼‚å¸¸å¤„ç†çš„è·³è½¬å‡½æ•°ï¼Œç„¶åè·³è½¬åˆ°æ°å½“çš„å¼‚å¸¸å¤„ç†å‡½æ•°å¹¶å¤„ç†å¼‚å¸¸ã€‚</p>
<p>å½“æ“ä½œç³»ç»Ÿçš„å¼‚å¸¸å¤„ç†å®Œæˆåï¼Œæ‰§è¡Œä¸€æ¡ eret æŒ‡ä»¤å³å¯ä»å¼‚å¸¸è¿”å›ã€‚è¿™æ¡æŒ‡ä»¤ä¼šè‡ªåŠ¨å®Œæˆå¦‚ä¸‹å·¥ä½œ</p>
<ul>
<li>ä» ELR_ELx ä¸­æ¢å¤ PC æŒ‡é’ˆ</li>
<li>ä» SPSR_ELx æ¢å¤å¤„ç†å™¨çš„çŠ¶æ€</li>
</ul>
<h1 id="å¼‚å¸¸å‘é‡è¡¨"><a class="markdownIt-Anchor" href="#å¼‚å¸¸å‘é‡è¡¨"></a> å¼‚å¸¸å‘é‡è¡¨</h1>
<p>ARMv7 æ¶æ„çš„å¼‚å¸¸å‘é‡è¡¨æ¯”è¾ƒç®€å•ï¼Œæ¯ä¸ªè¡¨é¡¹å ç”¨ 4 å­—èŠ‚ï¼Œå¹¶ä¸”æ¯ä¸ªè¡¨é¡¹é‡Œå­˜æ”¾äº†ä¸€æ¡è·³è½¬æŒ‡ä»¤ã€‚ä½†æ˜¯ ARMv8 æ¶æ„çš„å¼‚å¸¸å‘é‡è¡¨å‘ç”Ÿäº†å˜åŒ–ã€‚æ¯ä¸€ä¸ªè¡¨é¡¹éœ€è¦ 128 å­—èŠ‚ï¼Œè¿™æ ·å¯ä»¥å­˜æ”¾ 32 æ¡æŒ‡ä»¤ã€‚æ³¨æ„ï¼ŒARMv8 æŒ‡ä»¤é›†æ”¯æŒ 64 ä½æŒ‡ä»¤é›†ï¼Œä½†æ˜¯æ¯ä¸€æ¡æŒ‡ä»¤çš„ä½å®½æ˜¯ 32 ä½å®½è€Œä¸æ˜¯ 64 ä½å®½ã€‚</p>
<p>åœ¨ä¸‹è¡¨ä¸­ï¼Œå¼‚å¸¸å‘é‡è¡¨å­˜æ”¾çš„åŸºåœ°å€å¯ä»¥é€šè¿‡ VBAR ï¼ˆVector Base Address Registerï¼‰æ¥è®¾ç½®ã€‚VBAR æ˜¯å¼‚å¸¸å‘é‡è¡¨çš„åŸºåœ°å€å¯„å­˜å™¨ã€‚è§ã€ŠARM Architecture Reference Manualï¼ŒARMv8ï¼Œfor ARMv8-A architecture profile v8.4ã€‹çš„ D.1.10 èŠ‚ã€‚<br>
<img src="https://lsky.carlyleliu.vip/carlyleliu/ImageHosting/TechnologyBlog/Kernel/armv8_vector.png" alt=""></p>
<hr>
<h1 id="å¼‚å¸¸å‘é‡è¡¨åœ¨-linux-ä¸­çš„å®ç°æ‰©å±•"><a class="markdownIt-Anchor" href="#å¼‚å¸¸å‘é‡è¡¨åœ¨-linux-ä¸­çš„å®ç°æ‰©å±•"></a> å¼‚å¸¸å‘é‡è¡¨åœ¨ Linux ä¸­çš„å®ç°ï¼ˆæ‰©å±•ï¼‰</h1>
<h2 id="æ±‡ç¼–å®å®šä¹‰"><a class="markdownIt-Anchor" href="#æ±‡ç¼–å®å®šä¹‰"></a> æ±‡ç¼–å®å®šä¹‰</h2>
<p>è¦ç†è§£ä¸‹é¢è¿™æ®µä»£ç éœ€è¦å…ˆç®€å•äº†è§£ä¸€ä¸‹ä¸€äº›æ±‡ç¼–è¯­æ³•ï¼Œä¸‹é¢åšç®€å•ä»‹ç»ï¼š<br>
é¦–å…ˆæ˜¯ã€‚macro å‘½ä»¤ .macro å’Œ .endm ä¹‹é—´å…è®¸æ‚¨å®šä¹‰ç”Ÿæˆæ±‡ç¼–è¾“å‡ºçš„å®ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹è¿™æ®µå®å®šä¹‰ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.macro  sum from=0, to=5</span><br><span class="line">.long   \from</span><br><span class="line">.if     \to-\from</span><br><span class="line">sum     "(\from+1)",\to</span><br><span class="line">.endif</span><br><span class="line">.endm</span><br></pre></td></tr></tbody></table></figure>
<p>æ ¹æ®è¯¥å®šä¹‰ï¼Œâ€œSUM 0,5â€ç­‰æ•ˆäºä»¥ä¸‹ç¨‹åºé›†è¾“å…¥ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.long   0</span><br><span class="line">.long   1</span><br><span class="line">.long   2</span><br><span class="line">.long   3</span><br><span class="line">.long   4</span><br><span class="line">.long   5</span><br></pre></td></tr></tbody></table></figure>
<p>.macro comm å¼€å§‹å®šä¹‰ä¸€ä¸ªåä¸º comm çš„å®ï¼Œå®ƒä¸å¸¦å‚æ•°ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.macro plus1 p, p1</span><br><span class="line">.macro plus1 p p1</span><br></pre></td></tr></tbody></table></figure>
<p>ä»»ä¸€è¯­å¥éƒ½å¼€å§‹å®šä¹‰ä¸€ä¸ªåä¸º plus1 çš„å®ï¼Œå®ƒå¸¦æœ‰ä¸¤ä¸ªå‚æ•°ï¼›åœ¨å®å®šä¹‰ä¸­ï¼Œå†™â€œ\pâ€æˆ–â€œ\p1â€æ¥è®¡ç®—å‚æ•°ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.macro reserve_str p1=0 p2</span><br></pre></td></tr></tbody></table></figure>
<p>ä»¥ä¸¤ä¸ªå‚æ•°å¼€å§‹ä¸€ä¸ªåä¸º reserve_str çš„å®çš„å®šä¹‰ã€‚ ç¬¬ä¸€ä¸ªå‚æ•°æœ‰ä¸€ä¸ªé»˜è®¤å€¼ï¼Œä½†ç¬¬äºŒä¸ªæ²¡æœ‰ã€‚ å®šä¹‰å®Œæˆåï¼Œæ‚¨å¯ä»¥å°†å®è°ƒç”¨ä¸º â€˜reserve_str a,bâ€™ï¼ˆâ€˜\p1â€™ è®¡ç®—ä¸º aï¼Œâ€˜\p2â€™ è®¡ç®—ä¸º bï¼‰ï¼Œæˆ–ä¸º â€˜reserve_str ,bâ€™ï¼ˆä½¿ç”¨ â€˜\p1 â€™ è®¡ç®—ä¸ºé»˜è®¤å€¼ï¼Œåœ¨æœ¬ä¾‹ä¸­ä¸º â€˜0â€™ï¼Œâ€™\p2â€™ è®¡ç®—ä¸º b)ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.macro m p1:req, p2=0, p3:vararg</span><br></pre></td></tr></tbody></table></figure>
<p>ä»¥è‡³å°‘ä¸‰ä¸ªå‚æ•°å¼€å§‹ä¸€ä¸ªåä¸º m çš„å®çš„å®šä¹‰ã€‚ ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»å§‹ç»ˆæŒ‡å®šä¸€ä¸ªå€¼ï¼Œä½†ç¬¬äºŒä¸ªå‚æ•°ä¸æ˜¯ï¼Œè€Œæ˜¯å…·æœ‰é»˜è®¤å€¼ã€‚ ç¬¬ä¸‰ä¸ªå½¢å¼å°†è¢«åˆ†é…åœ¨è°ƒç”¨æ—¶æŒ‡å®šçš„æ‰€æœ‰å‰©ä½™å‚æ•°ã€‚</p>
<p>è°ƒç”¨å®æ—¶ï¼Œå¯ä»¥æŒ‰ä½ç½®æˆ–å…³é”®å­—æŒ‡å®šå‚æ•°å€¼ã€‚ ä¾‹å¦‚ï¼Œâ€œsum 9,17â€ç­‰ä»·äºâ€œsum to=17, from=9â€ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œç”±äºæ¯ä¸ª macargs éƒ½å¯ä»¥æ˜¯ä¸ç›®æ ‡æ¶æ„å…è®¸çš„ä»»ä½•å…¶ä»–æ ‡è¯†ç¬¦å®Œå…¨ç›¸åŒçš„æ ‡è¯†ç¬¦ï¼Œå› æ­¤å¦‚æœç›®æ ‡åœ¨æŸäº›å­—ç¬¦å‡ºç°åœ¨ç‰¹æ®Šä½ç½®æ—¶å¯¹å…¶åˆ¶ä½œäº†ç‰¹æ®Šå«ä¹‰ï¼Œåˆ™å¯èƒ½ä¼šå¶å°”å‡ºç°é—®é¢˜ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœå†’å· (ğŸ˜ƒ é€šå¸¸è¢«å…è®¸ä½œä¸ºç¬¦å·åç§°çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ¶æ„ç‰¹å®šä»£ç åœ¨ä½œä¸ºç¬¦å·çš„æœ€åä¸€ä¸ªå­—ç¬¦ï¼ˆä»¥è¡¨ç¤ºæ ‡ç­¾ï¼‰å‡ºç°æ—¶å°†å…¶ç‰¹æ®ŠåŒ–ï¼Œåˆ™å®å‚æ•°æ›¿æ¢ ä»£ç å°†æ— æ³•çŸ¥é“è¿™ä¸€ç‚¹å¹¶å°†æ•´ä¸ªæ„é€ ï¼ˆåŒ…æ‹¬å†’å·ï¼‰è§†ä¸ºæ ‡è¯†ç¬¦ï¼Œå¹¶ä»…æ£€æŸ¥æ­¤æ ‡è¯†ç¬¦æ˜¯å¦å—å‚æ•°æ›¿æ¢ã€‚ ä¾‹å¦‚è¿™ä¸ªå®å®šä¹‰ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">	.macro label l</span><br><span class="line">\l:</span><br><span class="line">	.endm</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>å¯èƒ½æ— æ³•æŒ‰é¢„æœŸå·¥ä½œã€‚ è°ƒç”¨â€œlabel fooâ€å¯èƒ½ä¸ä¼šåˆ›å»ºä¸€ä¸ªåä¸ºâ€œfooâ€çš„æ ‡ç­¾ï¼Œè€Œåªæ˜¯å°†æ–‡æœ¬â€œ\l:â€æ’å…¥åˆ°æ±‡ç¼–æºä»£ç ä¸­ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå…³äºæ— æ³•è¯†åˆ«çš„æ ‡è¯†ç¬¦çš„é”™è¯¯ã€‚</p>
<p>ç±»ä¼¼çš„é—®é¢˜å¯èƒ½ä¼šå‡ºç°åœ¨æ“ä½œç åç§°ï¼ˆä»¥åŠæ ‡è¯†ç¬¦åç§°ï¼‰ä¸­é€šå¸¸å…è®¸ä½¿ç”¨çš„å¥ç‚¹å­—ç¬¦ (â€˜.â€™) ä¸­ã€‚ å› æ­¤ï¼Œä¾‹å¦‚æ„é€ ä¸€ä¸ªå®ä»¥æ ¹æ®åŸºæœ¬åç§°å’Œé•¿åº¦è¯´æ˜ç¬¦æ„å»ºæ“ä½œç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.macro opcode base length</span><br><span class="line">       \base.\length</span><br><span class="line">.endm</span><br></pre></td></tr></tbody></table></figure>
<p>å¹¶å°†å…¶ä½œä¸ºâ€œopcode store lâ€è°ƒç”¨ä¸ä¼šåˆ›å»ºâ€œstore.lâ€æŒ‡ä»¤ï¼Œè€Œæ˜¯åœ¨æ±‡ç¼–å™¨å°è¯•è§£é‡Šæ–‡æœ¬â€œ\base.\lengthâ€æ—¶äº§ç”ŸæŸç§é”™è¯¯ã€‚<br>
æœ‰å‡ ç§å¯èƒ½çš„æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>Insert white space</li>
</ul>
<p>å¦‚æœå¯ä»¥ä½¿ç”¨ç©ºæ ¼å­—ç¬¦ï¼Œé‚£ä¹ˆè¿™æ˜¯æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">	.macro label l</span><br><span class="line">\l :</span><br><span class="line">	.endm</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>Use â€˜()â€™</li>
</ul>
<p>å­—ç¬¦ä¸²â€œ()â€å¯ç”¨äºå°†å®å‚æ•°çš„ç»“å°¾ä¸ä»¥ä¸‹æ–‡æœ¬åˆ†å¼€ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.macro opcode base length</span><br><span class="line">        \base\().\length</span><br><span class="line">	.endm</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>Use the alternate macro syntax mode</li>
</ul>
<p>åœ¨æ›¿ä»£å®è¯­æ³•æ¨¡å¼ä¸­ï¼Œä¸å·å­—ç¬¦ (â€˜&amp;â€™) å¯ç”¨ä½œåˆ†éš”ç¬¦ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">	.altmacro</span><br><span class="line">	.macro label l</span><br><span class="line">l&amp;:</span><br><span class="line">	.endm</span><br></pre></td></tr></tbody></table></figure>
<p>æ­£ç¡®è¯†åˆ«ä¼ªæ“ä½œçš„å­—ç¬¦ä¸²å‚æ•°çš„è¿™ä¸ªé—®é¢˜ä¹Ÿé€‚ç”¨äº .irp å’Œ .irpc ä¸­ä½¿ç”¨çš„æ ‡è¯†ç¬¦ã€‚</p>
<p>.endm æ ‡è®°å®å®šä¹‰çš„ç»“å°¾ã€‚</p>
<h2 id="æºç "><a class="markdownIt-Anchor" href="#æºç "></a> æºç </h2>
<p>ä¸‹é¢çœ‹ä¸‹ Linux ä¸­ arm64 çš„å¼‚å¸¸å‘é‡è¡¨ï¼Œåœ¨ arch/arm64/kernel/entry.S æ–‡ä»¶ä¸­æœ‰ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * Exception vectors.</span><br><span class="line"> */</span><br><span class="line">	.pushsection ".entry.text", "ax"</span><br><span class="line"></span><br><span class="line">	.align	11</span><br><span class="line">SYM_CODE_START(vectors)</span><br><span class="line">    # ä½¿ç”¨ SP0 å¯„å­˜å™¨çš„å½“å‰çš„å¼‚å¸¸ç±»å‹çš„å¼‚å¸¸å‘é‡è¡¨</span><br><span class="line">	kernel_ventry	1, t, 64, sync		// Synchronous EL1t</span><br><span class="line">	kernel_ventry	1, t, 64, irq		// IRQ EL1t</span><br><span class="line">	kernel_ventry	1, t, 64, fiq		// FIQ EL1h</span><br><span class="line">	kernel_ventry	1, t, 64, error		// Error EL1t</span><br><span class="line"></span><br><span class="line">    # ä½¿ç”¨ SPx å¯„å­˜å™¨çš„å½“å‰å¼‚å¸¸ç±»å‹çš„å¼‚å¸¸å‘é‡è¡¨</span><br><span class="line">	kernel_ventry	1, h, 64, sync		// Synchronous EL1h</span><br><span class="line">	kernel_ventry	1, h, 64, irq		// IRQ EL1h</span><br><span class="line">	kernel_ventry	1, h, 64, fiq		// FIQ EL1h</span><br><span class="line">	kernel_ventry	1, h, 64, error		// Error EL1h</span><br><span class="line"></span><br><span class="line">    # AArch64 ä¸‹ä½å¼‚å¸¸ç­‰çº§çš„å¼‚å¸¸å‘é‡è¡¨</span><br><span class="line">	kernel_ventry	0, t, 64, sync		// Synchronous 64-bit EL0</span><br><span class="line">	kernel_ventry	0, t, 64, irq		// IRQ 64-bit EL0</span><br><span class="line">	kernel_ventry	0, t, 64, fiq		// FIQ 64-bit EL0</span><br><span class="line">	kernel_ventry	0, t, 64, error		// Error 64-bit EL0</span><br><span class="line"></span><br><span class="line">    # AArch32 ä¸‹ä½å¼‚å¸¸ç­‰çº§çš„å¼‚å¸¸å‘é‡è¡¨</span><br><span class="line">	kernel_ventry	0, t, 32, sync		// Synchronous 32-bit EL0</span><br><span class="line">	kernel_ventry	0, t, 32, irq		// IRQ 32-bit EL0</span><br><span class="line">	kernel_ventry	0, t, 32, fiq		// FIQ 32-bit EL0</span><br><span class="line">	kernel_ventry	0, t, 32, error		// Error 32-bit EL0</span><br><span class="line">SYM_CODE_END(vectors)</span><br></pre></td></tr></tbody></table></figure>
<p>ä¸Šè¿°å¼‚å¸¸å‘é‡è¡¨çš„å®šä¹‰å’Œå‰é¢é‚£å¼ å›¾æ˜¯ä¸€è‡´çš„ï¼Œå…¶ä¸­ kernel_ventry æ˜¯ä¸€ä¸ªå®ï¼Œä»–çš„å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">	.macro kernel_ventry, el:req, ht:req, regsize:req, label:req</span><br><span class="line">	.align 7</span><br><span class="line">#ifdef CONFIG_UNMAP_KERNEL_AT_EL0</span><br><span class="line">	.if	\el == 0</span><br><span class="line">alternative_if ARM64_UNMAP_KERNEL_AT_EL0</span><br><span class="line">	.if	\regsize == 64</span><br><span class="line">	mrs	x30, tpidrro_el0</span><br><span class="line">	msr	tpidrro_el0, xzr</span><br><span class="line">	.else</span><br><span class="line">	mov	x30, xzr</span><br><span class="line">	.endif</span><br><span class="line">alternative_else_nop_endif</span><br><span class="line">	.endif</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">	sub	sp, sp, #PT_REGS_SIZE</span><br><span class="line">#ifdef CONFIG_VMAP_STACK</span><br><span class="line">	/*</span><br><span class="line">	 * Test whether the SP has overflowed, without corrupting a GPR.</span><br><span class="line">	 * Task and IRQ stacks are aligned so that SP &amp; (1 &lt;&lt; THREAD_SHIFT)</span><br><span class="line">	 * should always be zero.</span><br><span class="line">	 */</span><br><span class="line">	add	sp, sp, x0			// sp' = sp + x0</span><br><span class="line">	sub	x0, sp, x0			// x0' = sp' - x0 = (sp + x0) - x0 = sp</span><br><span class="line">	tbnz	x0, #THREAD_SHIFT, 0f</span><br><span class="line">	sub	x0, sp, x0			// x0'' = sp' - x0' = (sp + x0) - sp = x0</span><br><span class="line">	sub	sp, sp, x0			// sp'' = sp' - x0 = (sp + x0) - x0 = sp</span><br><span class="line">	b	el\el\ht\()_\regsize\()_\label</span><br><span class="line"></span><br><span class="line">0:</span><br><span class="line">	/*</span><br><span class="line">	 * Either we've just detected an overflow, or we've taken an exception</span><br><span class="line">	 * while on the overflow stack. Either way, we won't return to</span><br><span class="line">	 * userspace, and can clobber EL0 registers to free up GPRs.</span><br><span class="line">	 */</span><br><span class="line"></span><br><span class="line">	/* Stash the original SP (minus PT_REGS_SIZE) in tpidr_el0. */</span><br><span class="line">	msr	tpidr_el0, x0</span><br><span class="line"></span><br><span class="line">	/* Recover the original x0 value and stash it in tpidrro_el0 */</span><br><span class="line">	sub	x0, sp, x0</span><br><span class="line">	msr	tpidrro_el0, x0</span><br><span class="line"></span><br><span class="line">	/* Switch to the overflow stack */</span><br><span class="line">	adr_this_cpu sp, overflow_stack + OVERFLOW_STACK_SIZE, x0</span><br><span class="line"></span><br><span class="line">	/*</span><br><span class="line">	 * Check whether we were already on the overflow stack. This may happen</span><br><span class="line">	 * after panic() re-enables interrupts.</span><br><span class="line">	 */</span><br><span class="line">	mrs	x0, tpidr_el0			// sp of interrupted context</span><br><span class="line">	sub	x0, sp, x0			// delta with top of overflow stack</span><br><span class="line">	tst	x0, #~(OVERFLOW_STACK_SIZE - 1)	// within range?</span><br><span class="line">	b.ne	__bad_stack			// no? -&gt; bad stack pointer</span><br><span class="line"></span><br><span class="line">	/* We were already on the overflow stack. Restore sp/x0 and carry on. */</span><br><span class="line">	sub	sp, sp, x0</span><br><span class="line">	mrs	x0, tpidrro_el0</span><br><span class="line">#endif</span><br><span class="line">	b	el\el\ht\()_\regsize\()_\label</span><br><span class="line">	.endm</span><br></pre></td></tr></tbody></table></figure>
<p>.macro kernel_ventry, el:req, ht:req, regsize:req, label:req å®šä¹‰ kernel_ventry å®æœ‰ 4 ä¸ªå‚æ•°ï¼Œå…¶ä¸­ï¼šreq ä»£è¡¨è¿™ä¸ªå‚æ•°å¿…é¡»æä¾›ã€‚æ’‡å¼€å„ç§å®å®šä¹‰æˆ‘ä»¬çœ‹ä¸‹é‡Œé¢å…¶å®ä¸»è¦å°±æ˜¯å¦‚ä¸‹ä¸‰è¡Œä»£ç ï¼Œæˆ‘ä»¬ä¸€ä¸€åˆ†æï¼š</p>
<ul>
<li>.align 7</li>
</ul>
<p>è¡¨ç¤ºæŠŠä¸€æ¡æŒ‡ä»¤çš„åœ°å€å¯¹å…¶åˆ° 2 çš„ 7 æ¬¡æ–¹ï¼Œå³ 128 å­—èŠ‚ã€‚</p>
<ul>
<li>sub	sp, sp, #PT_REGS_SIZE</li>
</ul>
<p>sp æŒ‡é’ˆå‡å» PT_REGS_SIZEï¼ŒPT_REGS_SIZE çš„å®šä¹‰åœ¨ arch/arm64/kernel/asm_offset.c æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DEFINE(PT_REGS_SIZE,		<span class="keyword">sizeof</span>(<span class="keyword">struct</span> pt_regs));</span><br></pre></td></tr></tbody></table></figure>
<p>pt_regs å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">pt_regs</span> {</span></span><br><span class="line">	<span class="class"><span class="keyword">union</span> {</span></span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">user_pt_regs</span> <span class="title">user_regs</span>;</span></span><br><span class="line">		<span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">			u64 regs[<span class="number">31</span>];</span><br><span class="line">			u64 sp;</span><br><span class="line">			u64 pc;</span><br><span class="line">			u64 pstate;</span><br><span class="line">		};</span><br><span class="line">	};</span><br><span class="line">	u64 orig_x0;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __AARCH64EB__</span></span><br><span class="line">	u32 unused2;</span><br><span class="line">	s32 syscallno;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">	s32 syscallno;</span><br><span class="line">	u32 unused2;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">	u64 sdei_ttbr1;</span><br><span class="line">	<span class="comment">/* Only valid when ARM64_HAS_IRQ_PRIO_MASKING is enabled. */</span></span><br><span class="line">	u64 pmr_save;</span><br><span class="line">	u64 stackframe[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Only valid for some EL1 exceptions. */</span></span><br><span class="line">	u64 lockdep_hardirqs;</span><br><span class="line">	u64 exit_rcu;</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>è¯¥ç»“æ„å®šä¹‰äº†å¼‚å¸¸æœŸé—´å¯„å­˜å™¨åœ¨å †æ ˆä¸Šçš„å­˜å‚¨æ–¹å¼ã€‚ è¯·æ³¨æ„ sizeof(struct pt_regs) å¿…é¡»æ˜¯ 16 çš„å€æ•°ï¼ˆç”¨äºå †æ ˆå¯¹é½ï¼‰ã€‚</p>
<ul>
<li>b	el\el\ht()<em>\regsize()</em>\label</li>
</ul>
<p>ä»¥ kernel_ventry	1, t, 64, sync ä¸ºä¾‹å°†å®å±•å¼€å¾—åˆ°ï¼šel1t_64_sync, ä¸‹é¢æˆ‘ä»¬å»çœ‹çœ‹è¯¥æ ‡å·çš„å®ç°ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">	.macro entry_handler el:req, ht:req, regsize:req, label:req</span><br><span class="line">SYM_CODE_START_LOCAL(el\el\ht\()_\regsize\()_\label)</span><br><span class="line">	kernel_entry \el, \regsize</span><br><span class="line">	mov	x0, sp</span><br><span class="line">	bl	el\el\ht\()_\regsize\()_\label\()_handler</span><br><span class="line">	.if \el == 0</span><br><span class="line">	b	ret_to_user</span><br><span class="line">	.else</span><br><span class="line">	b	ret_to_kernel</span><br><span class="line">	.endif</span><br><span class="line">SYM_CODE_END(el\el\ht\()_\regsize\()_\label)</span><br><span class="line">	.endm</span><br><span class="line">/*</span><br><span class="line"> * Early exception handlers</span><br><span class="line"> */</span><br><span class="line">	entry_handler	1, t, 64, sync</span><br><span class="line">	entry_handler	1, t, 64, irq</span><br><span class="line">	entry_handler	1, t, 64, fiq</span><br><span class="line">	entry_handler	1, t, 64, error</span><br><span class="line"></span><br><span class="line">	entry_handler	1, h, 64, sync</span><br><span class="line">	entry_handler	1, h, 64, irq</span><br><span class="line">	entry_handler	1, h, 64, fiq</span><br><span class="line">	entry_handler	1, h, 64, error</span><br><span class="line"></span><br><span class="line">	entry_handler	0, t, 64, sync</span><br><span class="line">	entry_handler	0, t, 64, irq</span><br><span class="line">	entry_handler	0, t, 64, fiq</span><br><span class="line">	entry_handler	0, t, 64, error</span><br><span class="line"></span><br><span class="line">	entry_handler	0, t, 32, sync</span><br><span class="line">	entry_handler	0, t, 32, irq</span><br><span class="line">	entry_handler	0, t, 32, fiq</span><br><span class="line">	entry_handler	0, t, 32, error</span><br></pre></td></tr></tbody></table></figure>
<p>å°†	entry_handler	1, t, 64, sync å®å±•å¼€ï¼Œå¾—åˆ°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">el1t_64_sync:</span><br><span class="line">  	kernel_entry \el, \regsize</span><br><span class="line">	mov	x0, sp</span><br><span class="line">	bl	el\el\ht\()_\regsize\()_\label\()_handler</span><br><span class="line">	.if \el == 0</span><br><span class="line">	b	ret_to_user</span><br><span class="line">	.else</span><br><span class="line">	b	ret_to_kernel</span><br><span class="line">	.endif</span><br></pre></td></tr></tbody></table></figure>
<p>kernel_entry å®å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">	.macro	kernel_entry, el, regsize = 64</span><br><span class="line">	.if	\regsize == 32</span><br><span class="line">	mov	w0, w0				// zero upper 32 bits of x0</span><br><span class="line">	.endif</span><br><span class="line">	stp	x0, x1, [sp, #16 * 0]</span><br><span class="line">	stp	x2, x3, [sp, #16 * 1]</span><br><span class="line">	stp	x4, x5, [sp, #16 * 2]</span><br><span class="line">	stp	x6, x7, [sp, #16 * 3]</span><br><span class="line">	stp	x8, x9, [sp, #16 * 4]</span><br><span class="line">	stp	x10, x11, [sp, #16 * 5]</span><br><span class="line">	stp	x12, x13, [sp, #16 * 6]</span><br><span class="line">	stp	x14, x15, [sp, #16 * 7]</span><br><span class="line">	stp	x16, x17, [sp, #16 * 8]</span><br><span class="line">	stp	x18, x19, [sp, #16 * 9]</span><br><span class="line">	stp	x20, x21, [sp, #16 * 10]</span><br><span class="line">	stp	x22, x23, [sp, #16 * 11]</span><br><span class="line">	stp	x24, x25, [sp, #16 * 12]</span><br><span class="line">	stp	x26, x27, [sp, #16 * 13]</span><br><span class="line">	stp	x28, x29, [sp, #16 * 14]</span><br><span class="line"></span><br><span class="line">	.if	\el == 0</span><br><span class="line">	clear_gp_regs</span><br><span class="line">	mrs	x21, sp_el0</span><br><span class="line">	ldr_this_cpu	tsk, __entry_task, x20</span><br><span class="line">	msr	sp_el0, tsk</span><br><span class="line"></span><br><span class="line">	/*</span><br><span class="line">	 * Ensure MDSCR_EL1.SS is clear, since we can unmask debug exceptions</span><br><span class="line">	 * when scheduling.</span><br><span class="line">	 */</span><br><span class="line">	ldr	x19, [tsk, #TSK_TI_FLAGS]</span><br><span class="line">	disable_step_tsk x19, x20</span><br><span class="line"></span><br><span class="line">	/* Check for asynchronous tag check faults in user space */</span><br><span class="line">	check_mte_async_tcf x22, x23</span><br><span class="line">	apply_ssbd 1, x22, x23</span><br><span class="line"></span><br><span class="line">#ifdef CONFIG_ARM64_PTR_AUTH</span><br><span class="line">alternative_if ARM64_HAS_ADDRESS_AUTH</span><br><span class="line">	/*</span><br><span class="line">	 * Enable IA for in-kernel PAC if the task had it disabled. Although</span><br><span class="line">	 * this could be implemented with an unconditional MRS which would avoid</span><br><span class="line">	 * a load, this was measured to be slower on Cortex-A75 and Cortex-A76.</span><br><span class="line">	 *</span><br><span class="line">	 * Install the kernel IA key only if IA was enabled in the task. If IA</span><br><span class="line">	 * was disabled on kernel exit then we would have left the kernel IA</span><br><span class="line">	 * installed so there is no need to install it again.</span><br><span class="line">	 */</span><br><span class="line">	ldr	x0, [tsk, THREAD_SCTLR_USER]</span><br><span class="line">	tbz	x0, SCTLR_ELx_ENIA_SHIFT, 1f</span><br><span class="line">	__ptrauth_keys_install_kernel_nosync tsk, x20, x22, x23</span><br><span class="line">	b	2f</span><br><span class="line">1:</span><br><span class="line">	mrs	x0, sctlr_el1</span><br><span class="line">	orr	x0, x0, SCTLR_ELx_ENIA</span><br><span class="line">	msr	sctlr_el1, x0</span><br><span class="line">2:</span><br><span class="line">	isb</span><br><span class="line">alternative_else_nop_endif</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">	mte_set_kernel_gcr x22, x23</span><br><span class="line"></span><br><span class="line">	scs_load tsk</span><br><span class="line">	.else</span><br><span class="line">	add	x21, sp, #PT_REGS_SIZE</span><br><span class="line">	get_current_task tsk</span><br><span class="line">	.endif /* \el == 0 */</span><br><span class="line">	mrs	x22, elr_el1</span><br><span class="line">	mrs	x23, spsr_el1</span><br><span class="line">	stp	lr, x21, [sp, #S_LR]</span><br><span class="line"></span><br><span class="line">	/*</span><br><span class="line">	 * For exceptions from EL0, create a final frame record.</span><br><span class="line">	 * For exceptions from EL1, create a synthetic frame record so the</span><br><span class="line">	 * interrupted code shows up in the backtrace.</span><br><span class="line">	 */</span><br><span class="line">	.if \el == 0</span><br><span class="line">	stp	xzr, xzr, [sp, #S_STACKFRAME]</span><br><span class="line">	.else</span><br><span class="line">	stp	x29, x22, [sp, #S_STACKFRAME]</span><br><span class="line">	.endif</span><br><span class="line">	add	x29, sp, #S_STACKFRAME</span><br><span class="line"></span><br><span class="line">#ifdef CONFIG_ARM64_SW_TTBR0_PAN</span><br><span class="line">alternative_if_not ARM64_HAS_PAN</span><br><span class="line">	bl	__swpan_entry_el\el</span><br><span class="line">alternative_else_nop_endif</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">	stp	x22, x23, [sp, #S_PC]</span><br><span class="line"></span><br><span class="line">	/* Not in a syscall by default (el0_svc overwrites for real syscall) */</span><br><span class="line">	.if	\el == 0</span><br><span class="line">	mov	w21, #NO_SYSCALL</span><br><span class="line">	str	w21, [sp, #S_SYSCALLNO]</span><br><span class="line">	.endif</span><br><span class="line"></span><br><span class="line">	/* Save pmr */</span><br><span class="line">alternative_if ARM64_HAS_IRQ_PRIO_MASKING</span><br><span class="line">	mrs_s	x20, SYS_ICC_PMR_EL1</span><br><span class="line">	str	x20, [sp, #S_PMR_SAVE]</span><br><span class="line">	mov	x20, #GIC_PRIO_IRQON | GIC_PRIO_PSR_I_SET</span><br><span class="line">	msr_s	SYS_ICC_PMR_EL1, x20</span><br><span class="line">alternative_else_nop_endif</span><br><span class="line"></span><br><span class="line">	/* Re-enable tag checking (TCO set on exception entry) */</span><br><span class="line">#ifdef CONFIG_ARM64_MTE</span><br><span class="line">alternative_if ARM64_MTE</span><br><span class="line">	SET_PSTATE_TCO(0)</span><br><span class="line">alternative_else_nop_endif</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">	/*</span><br><span class="line">	 * Registers that may be useful after this macro is invoked:</span><br><span class="line">	 *</span><br><span class="line">	 * x20 - ICC_PMR_EL1</span><br><span class="line">	 * x21 - aborted SP</span><br><span class="line">	 * x22 - aborted PC</span><br><span class="line">	 * x23 - aborted PSTATE</span><br><span class="line">	*/</span><br><span class="line">	.endm</span><br></pre></td></tr></tbody></table></figure>
<p>è¿™é‡Œä¸åšè¯¦ç»†åˆ†æäº†ï¼Œé™¤äº†å¯¹ä¸€äº›å¯„å­˜å™¨åšåŸºç¡€å¤„ç†ï¼Œä¿å­˜åŸºæœ¬å’Œç‰¹æ®Šå¯„å­˜å™¨å€¼å¤–æœ€é‡è¦çš„å°±æ˜¯ bl	el\el\ht()<em>\regsize()</em>\label()_handlerï¼ŒåŒæ ·ä»¥ä¸Šé¢ç¬¬ä¸€ä¸ªå®å®šä¹‰ä¸ºä¾‹ï¼Œå±•å¼€ä¸º el1t_64_sync_handlerï¼Œè¿™äº›å‡½æ•°çš„å®šä¹‰å’Œå®ç°åœ¨ linux/arch/arm64/include/asm/exception.h å’Œ linux/arch/arm64/kernel/entry-common.c ä¸­ã€‚</p>
<p>åœ¨ä¸Šé¢çš„ä¸€ç³»åˆ—å‡½æ•°ä¸­ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªä¸­æ–­å‘é‡è¡¨ï¼ŒåŠå…¶é‡Œé¢çš„å‡½æ•°å®ç°ï¼Œå½“å¤–éƒ¨ä¸­æ–­å‘ç”Ÿæ—¶ï¼Œè·³è½¬åˆ°å…·ä½“æ ‡å¤„è¿è¡Œä»£ç ã€‚</p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p><span class="exturl" data-url="aHR0cHM6Ly9zb3VyY2V3YXJlLm9yZy9iaW51dGlscy9kb2NzL2FzL01hY3JvLmh0bWwjTWFjcm8=">https://sourceware.org/binutils/docs/as/Macro.html#Macro<i class="fa fa-external-link-alt"></i></span><br>
<span class="exturl" data-url="aHR0cHM6Ly9zb3VyY2V3YXJlLm9yZy9iaW51dGlscy9kb2NzL2FzLw==">https://sourceware.org/binutils/docs/as/<i class="fa fa-external-link-alt"></i></span><br>
ã€Šå¥”è·‘å§ Linux å†…æ ¸ã€‹<br>
ã€ŠLinux å†…æ ¸æ·±åº¦è§£æã€‹<br>
ã€ŠLinux è®¾å¤‡é©±åŠ¨å¼€å‘ã€‹</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="followme">
  <span>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¶å®ƒå‘å¸ƒæ¸ é“</span>

  <div class="social-list">

      <div class="social-item">
          <span class="social-link">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </span>

          <img class="social-item-img" src="/picture/qrcode_for_gh_ef4ee2392948_258.jpg">
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/Linux/" rel="tag"><i class="fa fa-tag"></i> Linux</a>
              <a href="/tags/Kernel/" rel="tag"><i class="fa fa-tag"></i> Kernel</a>
              <a href="/tags/Interrupt/" rel="tag"><i class="fa fa-tag"></i> Interrupt</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/LinuxKernel/LinuxKernelInterruptSummery/" rel="prev" title="Linux ä¸­æ–­å­ç³»ç»Ÿï¼ˆä¸€ï¼‰ç»¼è¿°">
                  <i class="fa fa-angle-left"></i> Linux ä¸­æ–­å­ç³»ç»Ÿï¼ˆä¸€ï¼‰ç»¼è¿°
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/Tools/WordpressUsage/" rel="next" title="WordPressæ­å»ºåšå®¢">
                  WordPressæ­å»ºåšå®¢ <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="waline"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2018 â€“ 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">CarlyleLiu</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>ç«™ç‚¹æ€»å­—æ•°ï¼š</span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">512k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>ç«™ç‚¹é˜…è¯»æ—¶é•¿ &asymp;</span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">31:03</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nhcmx5bGVsaXU=" title="åœ¨ GitHub ä¸Šå…³æ³¨æˆ‘" aria-label="åœ¨ GitHub ä¸Šå…³æ³¨æˆ‘"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  <script src="/js/third-party/pace.js"></script>


  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://waline.carlyleliu.vip","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"(å‘è¡¨è¯„è®º)","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":["nick"],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","el":"#waline","comment":true,"path":"/LinuxKernel/LinuxKernelInterruptARMExcept/"}</script>
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css">
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script>

</body>
</html>
